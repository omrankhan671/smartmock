<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer Review System - SmartMock</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <style>
        /* Purple Particles + Robot Theme (Home Style) */
        body {
            background: #000000 !important;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.05) 0%, transparent 70%);
/* REMOVED pointer-events:none to restore interactivity */
            z-index: 0;
        }
        
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
/* REMOVED pointer-events:none to restore interactivity */
            z-index: 0;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            background: #a855f7;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 20px rgba(168, 85, 247, 0.5);
            opacity: 0;
            animation: floatUpward linear infinite;
        }
        
        @keyframes floatUpward {
            0% {
                transform: translateY(100vh) translateX(0) scale(0);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-20vh) translateX(var(--drift)) scale(1);
                opacity: 0;
            }
        }
        
        #robotCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
/* REMOVED pointer-events:none to restore interactivity */
        }
        
        .peer-review-container {
            position: relative;
            z-index: 10;
        }
        
        .site-header {
            background: rgba(10, 10, 10, 0.8) !important;
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(168, 85, 247, 0.2);
            z-index: 2000 !important;
        }
        
        .logo-accent {
            color: #a855f7 !important;
            text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
        }
        
        .peer-review-container {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-header h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, #00f7ff 0%, #0077ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 15px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #00f7ff 0%, #0077ff 100%);
            color: white;
        }

        .tab:hover {
            background: rgba(0, 247, 255, 0.2);
            color: #00f7ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .review-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .review-card:hover {
            transform: translateY(-5px);
            border-color: #00f7ff;
            box-shadow: 0 10px 30px rgba(0, 247, 255, 0.3);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .reviewer-info {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .reviewer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00f7ff, #0077ff);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .reviewer-details h4 {
            margin: 0;
            color: #00f7ff;
            font-size: 1.1rem;
        }

        .reviewer-details .meta {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-completed {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status-in-review {
            background: rgba(0, 247, 255, 0.2);
            color: #00f7ff;
        }

        .interview-details {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .interview-details h5 {
            color: #00f7ff;
            margin: 0 0 10px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .stars {
            color: #ffc107;
            font-size: 1.2rem;
        }

        .rating-score {
            color: #00f7ff;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .feedback-preview {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.6;
            margin: 15px 0;
            max-height: 60px;
            overflow: hidden;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00f7ff 0%, #0077ff 100%);
            color: #fff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #00f7ff;
            border: 1px solid #00f7ff;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .request-review-card {
            background: rgba(0, 247, 255, 0.1);
            border: 2px dashed #00f7ff;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .request-review-card:hover {
            background: rgba(0, 247, 255, 0.2);
            transform: scale(1.02);
        }

        .request-review-card h3 {
            color: #00f7ff;
            margin: 15px 0;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #00f7ff 0%, #0077ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
        }

        @media (max-width: 768px) {
            .reviews-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles-container" id="particlesContainer"></div>

    <div class="peer-review-container">
        <div class="page-header">
            <h1>â­ Peer Review System</h1>
            <p>Get feedback from the community on your interview performance</p>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-value">12</div>
                <div class="stat-label">Reviews Given</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div class="stat-label">Reviews Received</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">4.7</div>
                <div class="stat-label">Average Rating</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">245</div>
                <div class="stat-label">Review Points</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('my-requests')">My Requests</button>
            <button class="tab" onclick="switchTab('review-others')">Review Others</button>
            <button class="tab" onclick="switchTab('completed')">Completed</button>
        </div>

        <!-- My Requests Tab -->
        <div class="tab-content active" id="my-requests">
            <div class="reviews-grid">
                <!-- Request New Review Card -->
                <div class="request-review-card" onclick="requestNewReview()">
                    <div style="font-size: 3rem;">ðŸ“¹</div>
                    <h3>Request New Review</h3>
                    <p style="color: rgba(255,255,255,0.7);">Upload your interview recording and get feedback from peers</p>
                </div>

                <!-- Pending Review Request -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">You</div>
                            <div class="reviewer-details">
                                <h4>Your Interview</h4>
                                <div class="meta">Requested 2 hours ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-pending">Pending</span>
                    </div>
                    <div class="interview-details">
                        <h5>CS Technical Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>45 minutes</span>
                        </div>
                        <div class="detail-row">
                            <span>Topics:</span>
                            <span>Data Structures, Algorithms</span>
                        </div>
                        <div class="detail-row">
                            <span>Reviewers:</span>
                            <span>0/3 completed</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="viewRecording('rec1')">View Recording</button>
                        <button class="btn btn-secondary" onclick="cancelRequest('req1')">Cancel</button>
                    </div>
                </div>

                <!-- In Review -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">You</div>
                            <div class="reviewer-details">
                                <h4>EE Circuit Analysis</h4>
                                <div class="meta">Requested yesterday</div>
                            </div>
                        </div>
                        <span class="status-badge status-in-review">In Review</span>
                    </div>
                    <div class="interview-details">
                        <h5>Electrical Engineering Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>38 minutes</span>
                        </div>
                        <div class="detail-row">
                            <span>Topics:</span>
                            <span>Circuit Theory, Network Analysis</span>
                        </div>
                        <div class="detail-row">
                            <span>Reviewers:</span>
                            <span>2/3 completed</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="viewFeedback('req2')">View Feedback (2)</button>
                        <button class="btn btn-secondary" onclick="viewRecording('rec2')">Recording</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Review Others Tab -->
        <div class="tab-content" id="review-others">
            <div class="reviews-grid">
                <!-- Available Review 1 -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">SK</div>
                            <div class="reviewer-details">
                                <h4>Sarah Khan</h4>
                                <div class="meta">Posted 3 hours ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-pending">Available</span>
                    </div>
                    <div class="interview-details">
                        <h5>Full Stack Developer Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>52 minutes</span>
                        </div>
                        <div class="detail-row">
                            <span>Topics:</span>
                            <span>React, Node.js, MongoDB</span>
                        </div>
                        <div class="detail-row">
                            <span>Reward:</span>
                            <span style="color: #ffc107; font-weight: 600;">+25 Points</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="startReview('rev1')">Start Review</button>
                        <button class="btn btn-secondary" onclick="previewInterview('rev1')">Preview</button>
                    </div>
                </div>

                <!-- Available Review 2 -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">AM</div>
                            <div class="reviewer-details">
                                <h4>Alex Martinez</h4>
                                <div class="meta">Posted 5 hours ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-pending">Available</span>
                    </div>
                    <div class="interview-details">
                        <h5>Python Backend Developer</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>41 minutes</span>
                        </div>
                        <div class="detail-row">
                            <span>Topics:</span>
                            <span>Django, REST APIs, PostgreSQL</span>
                        </div>
                        <div class="detail-row">
                            <span>Reward:</span>
                            <span style="color: #ffc107; font-weight: 600;">+20 Points</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="startReview('rev2')">Start Review</button>
                        <button class="btn btn-secondary" onclick="previewInterview('rev2')">Preview</button>
                    </div>
                </div>

                <!-- Available Review 3 -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">JD</div>
                            <div class="reviewer-details">
                                <h4>John Doe</h4>
                                <div class="meta">Posted 1 day ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-pending">Available</span>
                    </div>
                    <div class="interview-details">
                        <h5>System Design Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>60 minutes</span>
                        </div>
                        <div class="detail-row">
                            <span>Topics:</span>
                            <span>Scalability, Microservices</span>
                        </div>
                        <div class="detail-row">
                            <span>Reward:</span>
                            <span style="color: #ffc107; font-weight: 600;">+35 Points</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="startReview('rev3')">Start Review</button>
                        <button class="btn btn-secondary" onclick="previewInterview('rev3')">Preview</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Completed Tab -->
        <div class="tab-content" id="completed">
            <div class="reviews-grid">
                <!-- Completed Review 1 -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">PT</div>
                            <div class="reviewer-details">
                                <h4>Priya Tandon</h4>
                                <div class="meta">Reviewed 3 days ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-completed">Completed</span>
                    </div>
                    <div class="interview-details">
                        <h5>Your Java Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>48 minutes</span>
                        </div>
                    </div>
                    <div class="rating-display">
                        <div class="stars">â˜…â˜…â˜…â˜…â˜†</div>
                        <span class="rating-score">4.0/5.0</span>
                    </div>
                    <div class="feedback-preview">
                        "Great technical knowledge! Could improve communication clarity and provide more context when explaining solutions..."
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="viewFullReview('comp1')">View Full Review</button>
                    </div>
                </div>

                <!-- Completed Review 2 -->
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">RS</div>
                            <div class="reviewer-details">
                                <h4>Raj Sharma</h4>
                                <div class="meta">Reviewed 1 week ago</div>
                            </div>
                        </div>
                        <span class="status-badge status-completed">Completed</span>
                    </div>
                    <div class="interview-details">
                        <h5>Your React Interview</h5>
                        <div class="detail-row">
                            <span>Duration:</span>
                            <span>35 minutes</span>
                        </div>
                    </div>
                    <div class="rating-display">
                        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                        <span class="rating-score">5.0/5.0</span>
                    </div>
                    <div class="feedback-preview">
                        "Excellent performance! Strong understanding of React concepts, clean code structure, and great problem-solving approach..."
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="viewFullReview('comp2')">View Full Review</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <canvas id="robotCanvas"></canvas>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="assets/js/robot-interviewer.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/advanced-features-api.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // Initialize dynamic data on load
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                if (isUserAuthenticated()) {
                    // Load stats
                    const stats = await UserStatsAPI.getUserStats();
                    if (stats) {
                        const values = document.querySelectorAll('.stat-value');
                        // Expecting 4 stat cards in order
                        if (values[0]) values[0].textContent = stats.reviewsGiven ?? 0;
                        if (values[1]) values[1].textContent = stats.reviewsReceived ?? 0;
                        if (values[2]) values[2].textContent = (stats.averageRating ?? 0).toFixed(1);
                        if (values[3]) values[3].textContent = stats.points ?? 0;
                    }

                    // Load available reviews
                    await loadAvailableReviews();
                }
            } catch (e) {
                console.warn('Peer Review init failed', e);
            }
        });

        async function loadAvailableReviews() {
            try {
                const container = document.querySelector('#review-others .reviews-grid');
                if (!container) return;
                // Clear existing dynamic items (keep first child if it's a template?)
                container.innerHTML = '';
                const reviews = await PeerReviewAPI.getAvailableReviews();
                if (!reviews || reviews.length === 0) {
                    container.innerHTML = '<p style="color: rgba(255,255,255,0.7);">No reviews available at the moment. Check back soon!</p>';
                    return;
                }
                reviews.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'review-card';
                    card.innerHTML = `
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer-avatar">${(r.requesterName || '??').slice(0,2).toUpperCase()}</div>
                                <div class="reviewer-details">
                                    <h4>${r.requesterName || 'Anonymous'}</h4>
                                    <div class="meta">Posted ${timeAgo(r.createdAt)}</div>
                                </div>
                            </div>
                            <span class="status-badge status-pending">Available</span>
                        </div>
                        <div class="interview-details">
                            <h5>${r.title || 'Interview'}</h5>
                            <div class="detail-row"><span>Duration:</span><span>${r.duration || 'N/A'}</span></div>
                            <div class="detail-row"><span>Topics:</span><span>${(r.topics || []).join(', ')}</span></div>
                            <div class="detail-row"><span>Reward:</span><span style="color: #ffc107; font-weight: 600;">+${r.rewardPoints || 25} Points</span></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="startReview('${r.requestId}')">Start Review</button>
                            <button class="btn btn-secondary" onclick="previewInterview('${r.requestId}')">Preview</button>
                        </div>`;
                    container.appendChild(card);
                });
            } catch (e) {
                console.error('Failed to load available reviews', e);
            }
        }

        function timeAgo(ts) {
            try {
                const d = typeof ts === 'number' ? new Date(ts) : (ts?.toDate ? ts.toDate() : new Date());
                const diff = Math.floor((Date.now() - d.getTime())/1000);
                if (diff < 60) return `${diff}s ago`;
                const m = Math.floor(diff/60); if (m < 60) return `${m}m ago`;
                const h = Math.floor(m/60); if (h < 24) return `${h}h ago`;
                const days = Math.floor(h/24); return `${days}d ago`;
            } catch { return 'recently'; }
        }
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        async function requestNewReview() {
            if (!isUserAuthenticated()) {
                showNotification('âŒ Please login to request a review', 'error');
                return;
            }
            // Create temporary file input for upload
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'video/*';
            input.onchange = async () => {
                const file = input.files[0];
                if (!file) return;
                try {
                    showNotification('â³ Uploading recording...', 'info');
                    const path = `recordings/${getCurrentUser().uid}/${Date.now()}_${file.name}`;
                    const upload = await uploadFile(file, path);
                    const title = prompt('Interview title (e.g., Full Stack Interview)') || 'Interview Recording';
                    const duration = prompt('Duration (e.g., 45 minutes)') || 'Unknown';
                    const topicsStr = prompt('Topics (comma-separated)') || '';
                    const topics = topicsStr.split(',').map(s=>s.trim()).filter(Boolean);
                    const result = await PeerReviewAPI.requestReview({
                        title, duration, topics, recordingUrl: upload.downloadURL, storagePath: upload.path
                    });
                    showNotification('âœ… Review request created! -50 points', 'success');
                    // Reload available reviews for others (optional)
                } catch (e) {
                    console.error(e);
                    showNotification(e.message || 'âŒ Failed to request review', 'error');
                }
            };
            input.click();
        }

        async function startReview(requestId) {
            if (!isUserAuthenticated()) {
                showNotification('âŒ Please login to review', 'error');
                return;
            }
            try {
                // Simple rating prompts
                const tech = parseInt(prompt('Rate Technical Skills (1-5):') || '5', 10);
                const comm = parseInt(prompt('Rate Communication (1-5):') || '4', 10);
                const problem = parseInt(prompt('Rate Problem Solving (1-5):') || '5', 10);
                const quality = parseInt(prompt('Rate Code Quality (1-5):') || '4', 10);
                const feedback = prompt('Write your feedback:') || 'Great job!';
                const ratings = { technical: tech, communication: comm, problemSolving: problem, codeQuality: quality };
                await PeerReviewAPI.submitReview(requestId, ratings, feedback);
                showNotification('ðŸŽ +25 points earned! Review submitted.', 'success');
            } catch (e) {
                console.error(e);
                showNotification(e.message || 'âŒ Failed to submit review', 'error');
            }
        }

        function viewRecording(recId) {
            alert('ðŸ“¹ Opening interview recording player...\n\nFeatures:\nâ€¢ Playback controls\nâ€¢ Add timestamps for feedback\nâ€¢ Take notes during review\nâ€¢ Rate specific sections');
        }

        async function viewFeedback(reqId) {
            try {
                const reviews = await PeerReviewAPI.getReviewsForRequest(reqId);
                if (!reviews || reviews.length === 0) {
                    showNotification('No feedback yet. Check back soon!', 'info');
                    return;
                }
                const avg = (reviews.reduce((a,r)=>a+(r.average||0),0)/reviews.length).toFixed(1);
                const body = reviews.map((r,i)=>`#${i+1} (${r.average?.toFixed?.(1) || 'N/A'}/5)\n${r.feedback}` ).join('\n\n');
                alert(`ðŸ“ Feedback Summary\n\nAverage: ${avg}/5\n\n${body}`);
            } catch (e) {
                console.error(e);
                showNotification('âŒ Failed to load feedback', 'error');
            }
        }

        function viewFullReview(compId) {
            alert('â­ Full Review Details\n\nTechnical Skills: 5/5\nCommunication: 4/5\nProblem Solving: 5/5\nCode Quality: 4/5\n\nDetailed Feedback:\n"Your technical knowledge was impressive. The code structure was clean and well-commented. Consider explaining your thought process more clearly during the interview. Overall excellent performance!"\n\nReviewer Tips:\nâ€¢ Practice explaining while coding\nâ€¢ Use more descriptive variable names\nâ€¢ Great job handling edge cases');
        }

        function cancelRequest(reqId) {
            showNotification('â³ Cancel request is not available yet', 'info');
        }

        function previewInterview(revId) {
            showNotification('Opening preview (placeholder)', 'info');
        }
    </script>

    <!-- Purple Particles Generation -->
    <script>
        const particlesContainer = document.getElementById('particlesContainer');
        for (let i = 0; i < 120; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            const size = Math.random() * 4 + 2;
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            
            particle.style.left = Math.random() * 100 + '%';
            particle.style.bottom = '-10px';
            
            const duration = Math.random() * 13 + 12;
            const delay = Math.random() * 10;
            particle.style.animationDuration = duration + 's';
            particle.style.animationDelay = delay + 's';
            
            const drift = (Math.random() - 0.5) * 150;
            particle.style.setProperty('--drift', drift + 'px');
            
            particlesContainer.appendChild(particle);
        }
    </script>
    <script src="assets/js/auto-purple-bg.js"></script>
</body>
</html>

