<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SmartMock – Sign in or Create account</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs/%3E%3Ccircle cx='50' cy='50' r='46' fill='%2300e5ff'/%3E%3Ctext x='50' y='60' text-anchor='middle' font-size='54' font-family='Arial' fill='%230b0f1a'%3ES%3C/text%3E%3C/svg%3E"/>
    <style>
      /* Dark Black Theme with Purple Particles */
      body {
        background: #000000 !important;
        position: relative;
        overflow-x: hidden;
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.08) 0%, transparent 70%);
        pointer-events: none;
        z-index: 0;
      }
      
      .particles-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }
      
      .particle {
        position: absolute;
        background: #a855f7;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 20px rgba(168, 85, 247, 0.5);
        opacity: 0;
        animation: floatUpward linear infinite;
      }
      
      @keyframes floatUpward {
        0% {
          transform: translateY(100vh) translateX(0) scale(0);
          opacity: 0;
        }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% {
          transform: translateY(-20vh) translateX(var(--drift)) scale(1);
          opacity: 0;
        }
      }
      
      .auth-wrap, .auth-card {
        position: relative;
        z-index: 10;
      }
      
      .auth-card {
        background: rgba(18, 18, 18, 0.9) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(168, 85, 247, 0.3);
        box-shadow: 0 20px 60px rgba(168, 85, 247, 0.3);
      }
      
      .logo-accent {
        color: #a855f7 !important;
        text-shadow: 0 0 20px rgba(168, 85, 247, 0.6);
      }
      
      .btn.primary {
        background: linear-gradient(135deg, #a855f7, #d946ef) !important;
        box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
      }
      
      .btn.primary:hover {
        box-shadow: 0 15px 40px rgba(168, 85, 247, 0.6);
        transform: translateY(-2px);
      }
      
      .social-btn:hover {
        border-color: rgba(168, 85, 247, 0.5);
        box-shadow: 0 5px 20px rgba(168, 85, 247, 0.3);
      }
    </style>
  
    <style>
      /* Dark Black Theme with Purple Particles & Parallax */
      body {
        background: #000000 !important;
        position: relative;
        overflow-x: hidden;
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle at var(--gradient-x, 50%) var(--gradient-y, 50%), 
          rgba(168, 85, 247, 0.05) 0%, 
          transparent 70%
        );
        pointer-events: none;
        z-index: 0;
        will-change: transform;
        transition: background 0.3s ease;
      }
      
      .particles-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
        will-change: transform;
        transform-style: preserve-3d;
      }
      
      .particle {
        position: absolute;
        background: #a855f7;
        border-radius: 50%;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.5), 0 0 20px rgba(168, 85, 247, 0.5);
        opacity: 0;
        animation: floatUpward linear infinite;
      }
      
      @keyframes floatUpward {
        0% {
          transform: translateY(100vh) translateX(0) scale(0);
          opacity: 0;
        }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% {
          transform: translateY(-20vh) translateX(var(--drift)) scale(1);
          opacity: 0;
        }
      }
      
      header, main, section, .card, .hero-card, .auth-card, .report-card, .interview-container {
        position: relative;
        z-index: 10;
        will-change: transform;
        transform-style: preserve-3d;
      }
      
      .site-header {
        background: rgba(10, 10, 10, 0.8) !important;
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(168, 85, 247, 0.2);
        z-index: 2000 !important;
      }
      
      .card, .hero-card, .report-card {
        background: rgba(18, 18, 18, 0.8) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(168, 85, 247, 0.2);
        transition: all 0.3s ease;
      }
      
      .card:hover, .hero-card:hover, .report-card:hover, .hover-card:hover {
        border-color: rgba(168, 85, 247, 0.5);
        box-shadow: 0 10px 40px rgba(168, 85, 247, 0.3);
        transform: translateY(-5px);
      }
      
      .logo-accent {
        color: #a855f7 !important;
        text-shadow: 0 0 20px rgba(168, 85, 247, 0.5);
      }
      
      .btn.primary {
        background: linear-gradient(135deg, #a855f7, #d946ef) !important;
        box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4);
      }
      
      .btn.primary:hover {
        box-shadow: 0 15px 40px rgba(168, 85, 247, 0.6);
        transform: translateY(-2px);
      }
      
      .auth-card {
        background: rgba(18, 18, 18, 0.9) !important;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(168, 85, 247, 0.3);
        box-shadow: 0 20px 60px rgba(168, 85, 247, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- Background Robot & Particles Layer -->
    <div class="particles-container" id="particlesContainer"></div>
    <style>
      #bg-robot-container { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
      #bg-robot-container canvas { width: 100%; height: 100%; display: block; }
      .particles-container { z-index: 0; }
    </style>
    <div id="bg-robot-container"><canvas id="bg-robot-canvas"></canvas></div>
    <div class="auth-wrap">
      <div class="auth-card">
        <div class="auth-visual">
          <span class="badge">Welcome to</span>
          <h1><span class="logo">Smart</span><span class="logo-accent">Mock</span></h1>
          <p>Professional mock interviews, curated courses, and actionable reports to land your next role.</p>
          <div class="glow" aria-hidden="true"></div>
        </div>
        <div class="auth-forms">
          <div class="tabs">
            <button class="tab" data-tab="login">Sign In</button>
            <button class="tab" data-tab="signup">Create Account</button>
          </div>

          <form id="login-form" class="form" autocomplete="on">
            <div class="field">
              <label for="login-email">Email</label>
              <input id="login-email" name="email" type="email" placeholder="you@example.com" required />
            </div>
            <div class="field">
              <label for="login-password">Password</label>
              <input id="login-password" name="password" type="password" placeholder="••••••••" required />
            </div>
            <div class="actions">
              <button class="btn primary" type="submit">Continue</button>
              <a class="text-link" href="#" onclick="event.preventDefault(); alert('Reset link sent to your email (demo).');">Forgot password?</a>
            </div>
            
            <!-- Social Authentication -->
            <div class="divider">
              <span>OR continue with</span>
            </div>
            
            <div class="social-auth">
              <button type="button" class="btn social-btn google-btn" id="google-login-btn">
                <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                  <path d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9.003 18z" fill="#34A853"/>
                  <path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
                  <path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/>
                </svg>
                <span>Google</span>
              </button>
              
              <button type="button" class="btn social-btn phone-btn" id="phone-login-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z" fill="currentColor"/>
                </svg>
                <span>Phone</span>
              </button>
              
              <button type="button" class="btn social-btn guest-btn" id="guest-login-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="currentColor"/>
                </svg>
                <span>Try as Guest</span>
              </button>
            </div>
            
            <!-- Phone Login Modal -->
            <div id="phone-modal" class="modal" style="display: none;">
              <div class="modal-content">
                <span class="modal-close" id="phone-modal-close">&times;</span>
                <h3>Sign in with Phone</h3>
                <p style="color: rgba(255,255,255,0.7); margin-bottom: 20px;">Enter your phone number to receive a verification code</p>
                
                <!-- Firebase UI Container -->
                <div id="firebaseui-auth-container"></div>
                
                <div style="margin-top: 15px; text-align: center;">
                  <small style="color: rgba(255,255,255,0.5);">
                    Standard SMS rates may apply
                  </small>
                </div>
              </div>
            </div>
          </form>

          <form id="signup-form" class="form" autocomplete="on">
            <div class="field">
              <label for="signup-name">Full name</label>
              <input id="signup-name" name="name" type="text" placeholder="Jane Doe" required />
            </div>
            <div class="field">
              <label for="signup-email">Email</label>
              <input id="signup-email" name="email" type="email" placeholder="you@example.com" required />
            </div>
            <div class="field">
              <label for="signup-password">Password</label>
              <input id="signup-password" name="password" type="password" placeholder="Create a strong password" required />
            </div>
            <div class="actions">
              <button class="btn primary" type="submit">Create Account</button>
              <span class="muted">By continuing, you agree to our terms.</span>
            </div>
          </form>
          <div style="text-align: center; margin-top: 20px;">
            <a href="robot-animation/index.html" class="text-link" style="color: #00E5FF; text-decoration: none;">View 3D Robot Animation</a>
          </div>
        </div>
      </div>
    </div>

    <!-- CDN Fallback & Offline Detection (Load First!) -->
    <script src="assets/js/cdn-fallback.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script src="assets/js/firebase-config.js"></script>
    <script src="assets/js/main.js"></script>
    <!-- Three.js + Robot Interviewer -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="assets/js/robot-interviewer.js"></script>
    <script>
      (function initBgRobot(){
        if (typeof THREE === 'undefined' || typeof window.RobotInterviewer === 'undefined') {
          return setTimeout(initBgRobot, 100);
        }
        try {
          window.bgRobot = new window.RobotInterviewer('bg-robot-container', THREE, {
            canvasId: 'bg-robot-canvas',
            trackCursor: true
          });
          window.bgRobot.setState('neutral');
          console.log('✅ Background robot initialized on index.html');
        } catch(e){ console.error('❌ Robot init failed (index.html):', e); }
      })();
    </script>

    <!-- Firebase UI for Auth -->
    <script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css" />
    <style>
      /* Social Authentication Styles */
      .divider {
        display: flex;
        align-items: center;
        margin: 20px 0;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.875rem;
      }
      
      .divider::before,
      .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background: rgba(255, 255, 255, 0.1);
      }
      
      .divider span {
        padding: 0 15px;
      }
      
      .social-auth {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 15px;
      }
      
      .social-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 12px 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        color: white;
        font-weight: 500;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      
      .social-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      
      .google-btn:hover {
        background: rgba(66, 133, 244, 0.1);
        border-color: #4285F4;
      }
      
      .phone-btn:hover {
        background: rgba(0, 229, 255, 0.1);
        border-color: #00E5FF;
      }
      
      .guest-btn:hover {
        background: rgba(108, 99, 255, 0.1);
        border-color: #6C63FF;
      }
      
      .social-btn svg {
        flex-shrink: 0;
      }
      
      /* Phone Modal Styles */
      .modal {
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .modal-content {
        background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
        padding: 30px;
        border-radius: 16px;
        width: 90%;
        max-width: 450px;
        position: relative;
        border: 1px solid rgba(108, 99, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }
      
      .modal-content h3 {
        margin: 0 0 20px 0;
        color: white;
        font-size: 1.5rem;
      }
      
      .modal-close {
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 28px;
        font-weight: bold;
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        transition: color 0.3s ease;
      }
      
      .modal-close:hover {
        color: white;
      }
      
      .modal-content .field {
        margin-bottom: 20px;
      }
      
      .modal-content small {
        display: block;
        margin-top: 5px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.875rem;
      }
      
      #recaptcha-container {
        margin: 20px 0;
        display: flex;
        justify-content: center;
      }
      
      #verification-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      /* Firebase UI Custom Styling */
      #firebaseui-auth-container {
        margin: 20px 0;
      }
      
      .firebaseui-container {
        background: transparent !important;
        box-shadow: none !important;
        max-width: 100% !important;
        padding: 0 !important;
      }
      
      .firebaseui-card-content {
        padding: 0 !important;
      }
      
      .firebaseui-card-header {
        display: none !important;
      }
      
      .firebaseui-input,
      .firebaseui-input-invalid {
        background: rgba(255, 255, 255, 0.05) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: white !important;
        border-radius: 8px !important;
        padding: 12px !important;
        font-size: 0.95rem !important;
        font-family: 'Poppins', sans-serif !important;
      }
      
      .firebaseui-input:focus {
        border-color: #6C63FF !important;
        box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1) !important;
        outline: none !important;
      }
      
      .firebaseui-label {
        color: rgba(255, 255, 255, 0.9) !important;
        font-weight: 500 !important;
        font-family: 'Poppins', sans-serif !important;
        margin-bottom: 8px !important;
      }
      
      .firebaseui-button {
        background: linear-gradient(135deg, #6C63FF 0%, #5a52d5 100%) !important;
        border: none !important;
        border-radius: 8px !important;
        padding: 12px 24px !important;
        color: white !important;
        font-weight: 600 !important;
        font-family: 'Poppins', sans-serif !important;
        text-transform: none !important;
        letter-spacing: 0.5px !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
      }
      
      .firebaseui-button:hover {
        background: linear-gradient(135deg, #5a52d5 0%, #4a42c5 100%) !important;
        transform: translateY(-2px) !important;
        box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4) !important;
      }
      
      .firebaseui-textfield.mdl-textfield .firebaseui-label::after {
        background-color: #6C63FF !important;
      }
      
      .firebaseui-id-secondary-link {
        color: #00E5FF !important;
        font-family: 'Poppins', sans-serif !important;
      }
      
      .firebaseui-id-secondary-link:hover {
        color: #6C63FF !important;
      }
      
      .firebaseui-info-bar {
        background-color: rgba(108, 99, 255, 0.2) !important;
        border: 1px solid #6C63FF !important;
        border-radius: 8px !important;
        padding: 12px !important;
        color: white !important;
      }
      
      .firebaseui-error {
        color: #ff5555 !important;
        background: rgba(255, 85, 85, 0.1) !important;
        padding: 10px !important;
        border-radius: 6px !important;
        margin: 10px 0 !important;
      }
      
      .mdl-progress > .progressbar {
        background-color: #6C63FF !important;
      }
      
      .mdl-progress > .bufferbar {
        background: linear-gradient(to right, rgba(108, 99, 255, 0.2), rgba(108, 99, 255, 0.5)) !important;
      }
      
      .firebaseui-busy-indicator {
        border-top-color: #6C63FF !important;
      }
      
      .firebaseui-text {
        color: rgba(255, 255, 255, 0.8) !important;
        font-family: 'Poppins', sans-serif !important;
      }
      
      .firebaseui-list-item {
        color: rgba(255, 255, 255, 0.7) !important;
      }
      
      /* Country selector */
      .firebaseui-country-selector {
        background: rgba(255, 255, 255, 0.05) !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: white !important;
        border-radius: 8px !important;
      }
      
      .firebaseui-id-country-selector-flag {
        filter: brightness(1.2) !important;
      }
    </style>
    <script>
      // Login form handler
      document.getElementById('login-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const submitBtn = event.target.querySelector('button[type="submit"]');
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.textContent = 'Signing in...';
        
        try {
          const result = await signInWithEmail(email, password);
          
          if (result.success) {
            // Success! Redirect to dashboard
            window.location.href = 'home.html';
          } else {
            // Show error message
            alert('Login failed: ' + result.error);
            submitBtn.disabled = false;
            submitBtn.textContent = 'Continue';
          }
        } catch (error) {
          alert('Login failed: ' + error.message);
          submitBtn.disabled = false;
          submitBtn.textContent = 'Continue';
        }
      });

      // Signup form handler
      document.getElementById('signup-form').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const submitBtn = event.target.querySelector('button[type="submit"]');
        
        // Validate password strength
        if (password.length < 6) {
          alert('Password must be at least 6 characters long');
          return;
        }
        
        // Disable button and show loading
        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating account...';
        
        try {
          const result = await signUpWithEmail(email, password, name);
          
          if (result.success) {
            // Success! Redirect to dashboard
            window.location.href = 'home.html';
          } else {
            // Show error message
            alert('Registration failed: ' + result.error);
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create Account';
          }
        } catch (error) {
          alert('Registration failed: ' + error.message);
          submitBtn.disabled = false;
          submitBtn.textContent = 'Create Account';
        }
      });
      
      // Forgot password handler
      document.querySelector('.text-link').addEventListener('click', async function(event) {
        event.preventDefault();
        const email = document.getElementById('login-email').value;
        
        if (!email) {
          alert('Please enter your email address first');
          return;
        }
        
        const result = await resetPassword(email);
        if (result.success) {
          alert('Password reset email sent! Check your inbox.');
        } else {
          alert('Error: ' + result.error);
        }
      });
      
      // ============================================
      // MULTIPLE AUTHENTICATION HANDLERS
      // ============================================
      
      // Google Sign-In
      document.getElementById('google-login-btn').addEventListener('click', async function() {
        const btn = this;
        btn.disabled = true;
        btn.innerHTML = '<span>Signing in...</span>';
        
        try {
          const result = await signInWithGoogle();
          if (result.success) {
            if (result.redirect) {
              // Redirect method used, page will reload
              btn.innerHTML = '<span>Redirecting...</span>';
            } else {
              // Popup worked, redirect to home
              window.location.href = 'home.html';
            }
          } else {
            alert('Google sign-in failed: ' + result.error);
            btn.disabled = false;
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/><path d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9.003 18z" fill="#34A853"/><path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/><path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/></svg><span>Google</span>';
          }
        } catch (error) {
          alert('Error: ' + error.message);
          btn.disabled = false;
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/><path d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9.003 18z" fill="#34A853"/><path d="M3.964 10.712c-.18-.54-.282-1.117-.282-1.71 0-.593.102-1.17.282-1.71V4.96H.957C.347 6.175 0 7.55 0 9.002c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/><path d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.482 0 2.438 2.017.957 4.958L3.964 7.29c.708-2.127 2.692-3.71 5.036-3.71z" fill="#EA4335"/></svg><span>Google</span>';
        }
      });
      
      // Phone Sign-In Modal with Firebase UI
      const phoneModal = document.getElementById('phone-modal');
      const phoneLoginBtn = document.getElementById('phone-login-btn');
      const phoneModalClose = document.getElementById('phone-modal-close');
      let firebaseUIInstance = null;
      
      phoneLoginBtn.addEventListener('click', function() {
        phoneModal.style.display = 'flex';
        
        // Initialize Firebase UI if not already initialized
        if (!firebaseUIInstance) {
          firebaseUIInstance = new firebaseui.auth.AuthUI(auth);
          
          const uiConfig = {
            callbacks: {
              signInSuccessWithAuthResult: function(authResult, redirectUrl) {
                const user = authResult.user;
                const isNewUser = authResult.additionalUserInfo?.isNewUser;
                
                // Save profile for new users
                if (isNewUser) {
                  saveUserProfile(user.uid, {
                    phoneNumber: user.phoneNumber,
                    displayName: user.displayName || 'Phone User',
                    provider: 'phone',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                  }).then(() => {
                    phoneModal.style.display = 'none';
                    window.location.href = 'home.html';
                  });
                } else {
                  // Update last login for existing users
                  updateUserProfile(user.uid, {
                    lastLogin: new Date().toISOString()
                  }).then(() => {
                    phoneModal.style.display = 'none';
                    window.location.href = 'home.html';
                  });
                }
                
                return false; // Prevent automatic redirect
              },
              uiShown: function() {
                console.log('Firebase UI loaded');
              }
            },
            signInOptions: [
              {
                provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                defaultCountry: 'US',
                defaultNationalNumber: '',
                loginHint: '+1234567890',
                whitelistedCountries: ['US', 'GB', 'IN', 'CA', 'AU', 'PK', 'BD', 'NG', 'PH', 'VN'],
                recaptchaParameters: {
                  type: 'image',
                  size: 'normal',
                  badge: 'bottomleft'
                }
              }
            ],
            tosUrl: '#',
            privacyPolicyUrl: '#'
          };
          
          firebaseUIInstance.start('#firebaseui-auth-container', uiConfig);
        }
      });
      
      phoneModalClose.addEventListener('click', function() {
        phoneModal.style.display = 'none';
      });
      
      window.addEventListener('click', function(event) {
        if (event.target === phoneModal) {
          phoneModal.style.display = 'none';
        }
      });
      
      // Guest Sign-In
      document.getElementById('guest-login-btn').addEventListener('click', async function() {
        const btn = this;
        
        const confirmed = confirm('Sign in as guest? You can create an account later to save your progress.');
        if (!confirmed) return;
        
        btn.disabled = true;
        btn.innerHTML = '<span>Signing in...</span>';
        
        try {
          const result = await signInAsGuest();
          if (result.success) {
            window.location.href = 'home.html';
          } else {
            alert('Guest sign-in failed: ' + result.error);
            btn.disabled = false;
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="currentColor"/></svg><span>Try as Guest</span>';
          }
        } catch (error) {
          alert('Error: ' + error.message);
          btn.disabled = false;
          btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="currentColor"/></svg><span>Try as Guest</span>';
        }
      });
    </script>

    <!-- Particle Generation Script -->
    <script>
      // Create 120 floating purple particles
      const particlesContainer = document.getElementById('particlesContainer');
      const particleCount = 120;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random size (2-6px)
        const size = 2 + Math.random() * 4;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // Random horizontal position
        const leftPos = Math.random() * 100;
        particle.style.left = `${leftPos}%`;
        
        // Random animation duration (12-25 seconds)
        const duration = 12 + Math.random() * 13;
        particle.style.animationDuration = `${duration}s`;
        
        // Random delay
        const delay = Math.random() * 10;
        particle.style.animationDelay = `${delay}s`;
        
        // Random horizontal drift
        const drift = (Math.random() - 0.5) * 150;
        particle.style.setProperty('--drift', `${drift}px`);
        
        particlesContainer.appendChild(particle);
      }
    </script>
  
    <!-- Particle Generation Script -->
    <script>
      // Create 120 floating purple particles
      if (document.getElementById('particlesContainer')) {
        const particlesContainer = document.getElementById('particlesContainer');
        const particleCount = 120;

        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.classList.add('particle');
          
          const size = 2 + Math.random() * 4;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          
          const leftPos = Math.random() * 100;
          particle.style.left = `${leftPos}%`;
          
          const duration = 12 + Math.random() * 13;
          particle.style.animationDuration = `${duration}s`;
          
          const delay = Math.random() * 10;
          particle.style.animationDelay = `${delay}s`;
          
          const drift = (Math.random() - 0.5) * 150;
          particle.style.setProperty('--drift', `${drift}px`);
          
          particlesContainer.appendChild(particle);
        }
      }
    </script>
    
    <!-- Three.js + Robot Interviewer -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="assets/js/robot-interviewer.js"></script>
    <script>
      // Initialize Background Robot
      (function initBgRobot(){
        if (typeof THREE === 'undefined' || typeof window.RobotInterviewer === 'undefined') {
          return setTimeout(initBgRobot, 100);
        }
        try {
          window.bgRobot = new window.RobotInterviewer('bg-robot-container', THREE, {
            canvasId: 'bg-robot-canvas',
            trackCursor: true
          });
          window.bgRobot.setState('neutral');
          console.log('✅ Background robot initialized');
        } catch (e) {
          console.error('❌ Failed to init background robot:', e);
        }
      })();
      
      // Advanced Parallax and Depth Effect
      let targetX = 0, targetY = 0;
      let currentX = 0, currentY = 0;
      
      document.addEventListener('mousemove', (e) => {
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        targetX = (x - 0.5);
        targetY = (y - 0.5);
      });
      
      function animateParallax() {
        currentX += (targetX - currentX) * 0.1;
        currentY += (targetY - currentY) * 0.1;
        
        const container = document.getElementById('bg-robot-container');
        if (container) {
          const moveX1 = currentX * 80;
          const moveY1 = currentY * 80;
          const rotateY1 = currentX * 20;
          const rotateX1 = -currentY * 20;
          const scale1 = 1 + (Math.abs(currentX) + Math.abs(currentY)) * 0.05;
          
          container.style.transform = `
            perspective(2000px) 
            translateX(${moveX1}px) 
            translateY(${moveY1}px) 
            translateZ(-100px)
            rotateX(${rotateX1}deg) 
            rotateY(${rotateY1}deg)
            scale(${scale1})
          `;
        }
        
        const particles = document.getElementById('particlesContainer');
        if (particles) {
          const moveX2 = currentX * 40;
          const moveY2 = currentY * 40;
          particles.style.transform = `
            translateX(${moveX2}px) 
            translateY(${moveY2}px)
            translateZ(50px)
          `;
        }
        
        const bodyBefore = document.body;
        if (bodyBefore) {
          const gradientX = 50 + currentX * 10;
          const gradientY = 50 + currentY * 10;
          bodyBefore.style.setProperty('--gradient-x', `${gradientX}%`);
          bodyBefore.style.setProperty('--gradient-y', `${gradientY}%`);
        }
        
        const main = document.querySelector('main');
        if (main) {
          const moveX4 = -currentX * 15;
          const moveY4 = -currentY * 15;
          main.style.transform = `
            translateX(${moveX4}px) 
            translateY(${moveY4}px)
            translateZ(100px)
          `;
        }
        
        requestAnimationFrame(animateParallax);
      }
      
      animateParallax();
    </script>
  </body>
</html>